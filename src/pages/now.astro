---
import Layout from '../layouts/Layout.astro';
import fs from 'fs';
import { marked } from 'marked';

// Read and split now.md into entries
const nowPath = new URL('../content/now.md', import.meta.url);
const nowRaw = fs.readFileSync(nowPath, 'utf-8');
const entries = nowRaw.split(/\n---+\n/).map(e => e.trim()).filter(Boolean);
const [latest, ...archive] = entries;
---

<Layout title="NOW">
  <main class="container mx-auto px-4 py-8">
    <div class="max-w-3xl mx-auto">
      <div class="mb-12">
        <h1 class="text-4xl font-black tracking-tight text-white mb-4">
          What I'm Doing Now?
        </h1>
        <p class="text-gray-400 text-lg">
          Last updated: {latest.match(/# (.+)/)?.[1] ?? 'Recently'}
        </p>
      </div>

      <section class="mb-12">
        <div class="prose prose-invert max-w-none">
          <Fragment set:html={marked.parse(latest)} />
        </div>
      </section>

      {archive.length > 0 && (
        <section>
          <h2 class="text-2xl font-bold text-white mb-6 mt-10">Archive</h2>
          <div class="space-y-10">
            {archive.map(entry => (
              <div class="prose prose-invert max-w-none border-l border-gray-700 pl-4">
                <Fragment set:html={marked.parse(entry)} />
              </div>
            ))}
          </div>
        </section>
      )}

      <div class="mt-12 text-center">
        <p class="text-gray-400">
          This page is inspired by <a href="https://nownownow.com/about" target="_blank" rel="noopener noreferrer" class="text-white hover:text-gray-300 transition-colors">Derek Sivers' /now page movement</a>
        </p>
      </div>
    </div>
  </main>
</Layout>

<style>
  section {
    opacity: 0;
    transform: translateY(20px);
    animation: fadeInUp 0.6s ease-out forwards;
  }

  section:nth-child(1) { animation-delay: 0.1s; }
  section:nth-child(2) { animation-delay: 0.2s; }
  section:nth-child(3) { animation-delay: 0.3s; }
  section:nth-child(4) { animation-delay: 0.4s; }

  @keyframes fadeInUp {
    to {
      opacity: 1;
      transform: translateY(0);
    }
  }
</style> 